<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dns_tsig (dns-tsig.Dns_tsig)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">dns-tsig</a> &#x00BB; Dns_tsig</nav><h1>Module <code>Dns_tsig</code></h1></header><aside><p>DNS TSIG signatures</p></aside><aside><p>As specified by <a href="https://tools.ietf.org/html/rfc2845">RFC 2845</a></p></aside><dl><dt class="spec value" id="val-sign"><a href="#val-sign" class="anchor"></a><code><span class="keyword">val</span> sign : <a href="../../dns/Dns/Tsig_op/index.html#type-sign">Dns.Tsig_op.sign</a></code></dt><dd><p><code>sign ~mac ~max_size name tsig ~key packet buffer</code> signs the given <code>buffer</code> with the provided <code>key</code>, its <code>name</code>, the <code>tsig</code>. The <code>mac</code> argument is expected when a reply to a signed DNS packet should be signed. If signing fails, an error may be produced. The result is a buffer and a mac.</p></dd></dl><dl><dt class="spec value" id="val-verify"><a href="#val-verify" class="anchor"></a><code><span class="keyword">val</span> verify : <a href="../../dns/Dns/Tsig_op/index.html#type-verify">Dns.Tsig_op.verify</a></code></dt><dd><p><code>verify ~mac now packet name ~key tsig buffer</code> verifies the <code>buffer</code> using the provided <code>tsig</code>, <code>key</code> and <code>name</code>.</p></dd></dl><dl><dt class="spec type" id="type-s"><a href="#type-s" class="anchor"></a><code><span class="keyword">type</span> s</code> = <code>[ </code><table class="variant"><tr id="type-s.Key_algorithm" class="anchored"><td class="def constructor"><a href="#type-s.Key_algorithm" class="anchor"></a><code>| </code><code>`Key_algorithm <span class="keyword">of</span> <a href="../../dns/Dns/Dnskey/index.html#type-t">Dns.Dnskey.t</a></code></td></tr><tr id="type-s.Tsig_creation" class="anchored"><td class="def constructor"><a href="#type-s.Tsig_creation" class="anchor"></a><code>| </code><code>`Tsig_creation</code></td></tr><tr id="type-s.Sign" class="anchored"><td class="def constructor"><a href="#type-s.Sign" class="anchor"></a><code>| </code><code>`Sign</code></td></tr></table><code> ]</code></dt><dd><p>The type for signing errors.</p></dd></dl><dl><dt class="spec value" id="val-pp_s"><a href="#val-pp_s" class="anchor"></a><code><span class="keyword">val</span> pp_s : <span><a href="index.html#type-s">s</a> Fmt.t</span></code></dt><dd><p><code>pp_s ppf s</code> pretty-prints <code>s</code> on <code>ppf</code>.</p></dd></dl><dl><dt class="spec value" id="val-encode_and_sign"><a href="#val-encode_and_sign" class="anchor"></a><code><span class="keyword">val</span> encode_and_sign : <span>?&#8288;proto:<a href="../../dns/Dns/index.html#type-proto">Dns.proto</a></span> <span>&#45;&gt;</span> <span>?&#8288;mac:Cstruct.t</span> <span>&#45;&gt;</span> <a href="../../dns/Dns/Packet/index.html#type-t">Dns.Packet.t</a> <span>&#45;&gt;</span> Ptime.t <span>&#45;&gt;</span> <a href="../../dns/Dns/Dnskey/index.html#type-t">Dns.Dnskey.t</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Domain_name.t</span> <span>&#45;&gt;</span> <span><span>(Cstruct.t * Cstruct.t, <a href="index.html#type-s">s</a>)</span> Stdlib.result</span></code></dt><dd><p><code>encode_and_sign ~proto ~mac t now dnskey name</code> signs and encodes the DNS packet. If a reply to a request is signed, the <code>mac</code> argument should be the message authentication code from the request (needed to sign the reply). The returned value is the encoded byte buffer and the mac of the packet (useful for passing into <a href="index.html#val-decode_and_verify"><code>decode_and_verify</code></a> when receiving a reply to the signed request).</p></dd></dl><dl><dt class="spec type" id="type-e"><a href="#type-e" class="anchor"></a><code><span class="keyword">type</span> e</code> = <code>[ </code><table class="variant"><tr id="type-e.Decode" class="anchored"><td class="def constructor"><a href="#type-e.Decode" class="anchor"></a><code>| </code><code>`Decode <span class="keyword">of</span> <a href="../../dns/Dns/Packet/index.html#type-err">Dns.Packet.err</a></code></td></tr><tr id="type-e.Unsigned" class="anchored"><td class="def constructor"><a href="#type-e.Unsigned" class="anchor"></a><code>| </code><code>`Unsigned <span class="keyword">of</span> <a href="../../dns/Dns/Packet/index.html#type-t">Dns.Packet.t</a></code></td></tr><tr id="type-e.Crypto" class="anchored"><td class="def constructor"><a href="#type-e.Crypto" class="anchor"></a><code>| </code><code>`Crypto <span class="keyword">of</span> <a href="../../dns/Dns/Tsig_op/index.html#type-e">Dns.Tsig_op.e</a></code></td></tr><tr id="type-e.Invalid_key" class="anchored"><td class="def constructor"><a href="#type-e.Invalid_key" class="anchor"></a><code>| </code><code>`Invalid_key <span class="keyword">of</span> <span><span>[ `raw ]</span> Domain_name.t</span> * <span><span>[ `raw ]</span> Domain_name.t</span></code></td></tr></table><code> ]</code></dt><dd><p>The type for decode and verify errors.</p></dd></dl><dl><dt class="spec value" id="val-pp_e"><a href="#val-pp_e" class="anchor"></a><code><span class="keyword">val</span> pp_e : <span><a href="index.html#type-e">e</a> Fmt.t</span></code></dt><dd><p><code>pp_e ppf e</code> prety-prints <code>e</code> on <code>ppf</code>.</p></dd></dl><dl><dt class="spec value" id="val-decode_and_verify"><a href="#val-decode_and_verify" class="anchor"></a><code><span class="keyword">val</span> decode_and_verify : Ptime.t <span>&#45;&gt;</span> <a href="../../dns/Dns/Dnskey/index.html#type-t">Dns.Dnskey.t</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Domain_name.t</span> <span>&#45;&gt;</span> <span>?&#8288;mac:Cstruct.t</span> <span>&#45;&gt;</span> Cstruct.t <span>&#45;&gt;</span> <span><span>(<a href="../../dns/Dns/Packet/index.html#type-t">Dns.Packet.t</a> * <a href="../../dns/Dns/Tsig/index.html#type-t">Dns.Tsig.t</a> * Cstruct.t, <a href="index.html#type-e">e</a>)</span> Stdlib.result</span></code></dt><dd><p><code>decode_and_verify now dnskey name ~mac buffer</code> decodes and verifies the given buffer using the key material, resulting in a DNS packet, a signature, and the <code>mac</code>, or a failure. The optional <code>mac</code> argument should be provided if an answer to a signed DNS packet is to be decoded.</p></dd></dl></div></body></html>